<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LP Bot Dashboard</title>
    <link rel="icon" href="./favicon.svg" type="image/svg+xml" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="header-bar">
      <div class="header-left">
        <img class="header-logo" src="./favicon.svg" alt="LP Bot" />
        <p class="eyebrow">LP BOT</p>
      </div>
      <div class="header-right">
        <div class="status-pill" id="status-chip">polling on</div>
      </div>
    </header>

    <div class="layout">
      <aside class="sidebar">
        <div class="brand"></div>
        <nav class="nav">
          <button class="nav-item active" data-view="positions">Positions</button>
          <button class="nav-item" data-view="history">History</button>
          <button class="nav-item" data-view="settings">Settings</button>
        </nav>
        <div class="sidebar-footer">
          <p class="hint">Environment: Arbitrum</p>
        </div>
      </aside>

      <main class="app">

        <section class="view view-active" id="view-positions">
          <section class="grid-main">
          <div class="grid-left">
            <div class="grid-top">
              <article class="stat-card" id="card-net">
                <p class="card-title">Position Size</p>
                <p class="stat-value">
                  <span id="net-value">-</span>
                  <span class="value-inline hidden" id="net-pnl">-</span>
                </p>
                <div class="ratio-bar" aria-hidden="true">
                  <div class="ratio-fill ratio-token0" id="ratio-fill"></div>
                  <div class="ratio-fill ratio-token1" id="ratio-fill-1"></div>
                </div>
                <p class="ratio-text" id="ratio-text">-</p>
              </article>
              <article class="stat-card" id="card-fees">
                <p class="card-title">Fees</p>
                <p class="stat-value" id="fees">-</p>
                <div class="ratio-bar" aria-hidden="true">
                  <div class="ratio-fill ratio-token0" id="fee-ratio-fill"></div>
                  <div class="ratio-fill ratio-token1" id="fee-ratio-fill-1"></div>
                </div>
                <p class="ratio-text" id="fee-ratio-text">-</p>
              </article>
              <article class="stat-card" id="card-profit">
                <p class="card-title">Profit</p>
                <p class="stat-value">
                  <span class="stat-value inline" id="profit-total">-</span>
                  <span class="stat-value inline profit-inline" id="profit-sub">-</span>
                </p>
                <p class="stat-sub" id="profit-detail">-</p>
                <div class="ratio-stack" aria-hidden="true">
                  <div class="ratio-bar ratio-positive" id="profit-ratio-positive">
                    <div class="ratio-fill ratio-pnl" id="profit-ratio-pnl-pos"></div>
                    <div class="ratio-fill ratio-fees" id="profit-ratio-fees-pos"></div>
                  </div>
                  <div class="ratio-bar ratio-negative" id="profit-ratio-negative">
                    <div class="ratio-fill ratio-pnl" id="profit-ratio-pnl-neg"></div>
                    <div class="ratio-fill ratio-gas" id="profit-ratio-gas"></div>
                    <div class="ratio-fill ratio-swap" id="profit-ratio-swap"></div>
                  </div>
                </div>
                <p class="ratio-text profit-ratio-text" id="profit-ratio-text">-</p>
              </article>
            </div>
          <div class="grid-bottom">
            <article class="card" id="card-active">
              <div class="card-header">
                <h2 class="card-title">Active Position</h2>
                <span class="value status-pill" id="active-status">-</span>
              </div>
              <div class="metric-list compact">
                <div class="metric">
                  <span class="label">Token ID</span>
                  <span class="value" id="active-token">-</span>
                </div>
                <div class="metric">
                  <span class="label">Size (created)</span>
                  <span class="value" id="active-size">-</span>
                </div>
                <div class="metric">
                  <span class="label">Range (tick)</span>
                  <span class="value" id="active-range">-</span>
                </div>
              </div>
              <details class="card-details" id="active-details">
                <summary class="details-toggle">Show details</summary>
                <div class="metric-list">
                  <div class="metric">
                    <span class="label">Range (price)</span>
                    <span class="value" id="active-range-price">-</span>
                  </div>
                  <div class="metric">
                    <span class="label">Range (stop)</span>
                    <span class="value" id="active-stop-loss">-</span>
                  </div>
                  <div class="metric">
                    <span class="label">ETH Price (created)</span>
                    <span class="value" id="active-price">-</span>
                  </div>
                  <div class="metric">
                    <span class="label">Gas (created)</span>
                    <span class="value" id="active-gas">-</span>
                  </div>
                  <div class="metric">
                    <span class="label">Swap Fee</span>
                    <span class="value" id="active-swap-fee">-</span>
                  </div>
                </div>
              </details>
            </article>

          <article class="card" id="card-live">
            <h2 class="card-title live-title">LIVE<span class="live-dot" aria-hidden="true"></span></h2>
            <p class="stat-value" id="price">-</p>
            <p class="stat-sub">Created Price <span id="created-price">-</span></p>
            <p class="stat-sub"><span class="stat-value inline" id="hold-time">-</span></p>
            <p class="stat-sub">Created at <span id="created-at">-</span></p>
            <p class="stat-sub">
              <span class="stat-value inline" id="rebalance-eta-remaining">-</span>
              <span class="stat-value inline" id="rebalance-eta-total">/ -</span>
            </p>
          </article>
          <article class="card log-card" id="card-logs">
            <div class="chart-header">
              <h2 class="card-title">Monitor Logs</h2>
              <span class="stat-sub" id="log-status">-</span>
            </div>
            <pre class="log-stream" id="monitor-logs">-</pre>
          </article>
            </div>
          <div class="grid-charts">
            <article class="card chart-card" id="card-chart">
              <div class="chart-header">
                <h2 class="card-title">Pool Price</h2>
                <span class="stat-sub" id="chart-profit">-</span>
              </div>
              <div class="chart-wrap">
                <canvas id="price-chart" height="200" aria-label="Price chart"></canvas>
              </div>
              <p class="stat-sub" id="chart-meta">-</p>
            </article>
            <article class="card chart-card" id="card-fee-chart">
              <div class="chart-header">
                <h2 class="card-title">Fees (Log)</h2>
                <span class="stat-sub" id="fee-chart-meta">-</span>
              </div>
              <div class="chart-wrap">
                <canvas id="fee-chart" height="200" aria-label="Fee chart"></canvas>
              </div>
            </article>
          </div>
        </div>

        <div class="grid-right">
          <article class="card wallet-card" id="card-wallet">
            <div class="wallet-header">
              <div class="wallet-account">
                <div class="wallet-title-row">
                  <span class="wallet-title">Wallet</span>
                  <span class="wallet-chain" aria-hidden="true">
                    <svg class="chain-logo" id="wallet-chain-logo">
                      <use href="#chain-arbitrum"></use>
                    </svg>
                  </span>
                </div>
                <span class="wallet-address mono" id="wallet-address">-</span>
              </div>
              <div class="wallet-total">
                <span class="wallet-total-value" id="wallet-total-usd">-</span>
                <span class="wallet-total-sub" id="wallet-total-with-position">-</span>
              </div>
            </div>
            <div class="wallet-list">
              <div class="wallet-row">
                <div class="wallet-token">
                  <span class="wallet-icon token0">
                    <svg class="token-logo" id="wallet-token0-logo" aria-hidden="true">
                      <use href="#token-placeholder"></use>
                    </svg>
                    <span class="token-fallback" id="wallet-token0-fallback">-</span>
                  </span>
                  <div>
                    <div class="wallet-symbol" id="wallet-token0-name">-</div>
                    <div class="wallet-sub" id="wallet-token0-sub">-</div>
                  </div>
                </div>
                <div class="wallet-amount">
                  <div class="wallet-usd" id="wallet-token0-usd">-</div>
                  <div class="wallet-qty" id="wallet-token0-amount">-</div>
                </div>
              </div>
              <div class="wallet-row">
                <div class="wallet-token">
                  <span class="wallet-icon token1">
                    <svg class="token-logo" id="wallet-token1-logo" aria-hidden="true">
                      <use href="#token-placeholder"></use>
                    </svg>
                    <span class="token-fallback" id="wallet-token1-fallback">-</span>
                  </span>
                  <div>
                    <div class="wallet-symbol" id="wallet-token1-name">-</div>
                    <div class="wallet-sub" id="wallet-token1-sub">-</div>
                  </div>
                </div>
                <div class="wallet-amount">
                  <div class="wallet-usd" id="wallet-token1-usd">-</div>
                  <div class="wallet-qty" id="wallet-token1-amount">-</div>
                </div>
              </div>
              <div class="wallet-row">
                <div class="wallet-token">
                  <span class="wallet-icon native">
                    <svg class="token-logo" id="wallet-native-logo" aria-hidden="true">
                      <use href="#token-placeholder"></use>
                    </svg>
                    <span class="token-fallback" id="wallet-native-fallback">-</span>
                  </span>
                  <div>
                    <div class="wallet-symbol" id="wallet-native-name">-</div>
                    <div class="wallet-sub" id="wallet-native-sub">-</div>
                  </div>
                </div>
                <div class="wallet-amount">
                  <div class="wallet-usd" id="wallet-native-usd">-</div>
                  <div class="wallet-qty" id="wallet-native-amount">-</div>
                </div>
              </div>
            </div>
          </article>

          <article class="card" id="card-actions">
            <h2 class="card-title">Actions</h2>
            <div class="actions">
              <button class="btn ghost" id="btn-rebalance">Manual Rebalance</button>
              <button class="btn ghost" id="btn-close">Close Position</button>
              <button class="btn ghost toggle" id="btn-stop-auto-close">Auto Close Only</button>
            </div>
            <form id="config-form" class="form-grid form-divider">
              <label>
                Tick Range
                <input type="number" name="tickRange" step="1" />
                <span class="form-note" id="tick-range-price">-</span>
              </label>
              <label>
                Delay (sec)
                <input type="number" name="rebalanceDelaySec" step="1" />
              </label>
              <label>
                Slippage (bps)
                <input type="number" name="slippageBps" step="1" />
              </label>
              <label>
                Stop Loss (%)
                <input type="number" name="stopLossPercent" step="0.1" />
                <span class="form-note" id="stop-loss-preview">-</span>
              </label>
              <label>
                Max Gas (gwei)
                <input type="number" name="maxGasPriceGwei" step="1" />
              </label>
              <label>
                Position Size (token1)
                <input type="number" name="targetTotalToken1" step="0.0001" />
              </label>
              <button type="submit" class="btn primary" id="btn-create">Create Position</button>
            </form>
            <p class="hint" id="create-hint"></p>
          </article>
        </div>
          </section>
        </section>

        <section class="view" id="view-history">
          <div class="history-charts-standalone">
            <div class="card history-chart">
              <div class="chart-header">
                <h2 class="card-title">Profit Trend</h2>
                <span class="stat-sub" id="history-total-profit">-</span>
              </div>
              <canvas id="history-profit-chart" height="160"></canvas>
            </div>
            <div class="card history-chart">
              <div class="chart-header">
                <h2 class="card-title">Today Profit</h2>
                <span class="stat-sub" id="history-today-total">-</span>
              </div>
              <canvas id="history-today-chart" height="160"></canvas>
            </div>
          </div>
          <div class="card history-card">
            <h2 class="card-title">History</h2>
            <p class="stat-sub" id="history-empty">No closed positions.</p>
            <div class="table-wrap">
              <table class="history-table">
                <thead>
                  <tr>
                    <th>Token ID</th>
                    <th>Range</th>
                    <th>Size (created)</th>
                    <th>Closed Net</th>
                    <th>Fees</th>
                    <th>PnL</th>
                    <th>Gas</th>
                    <th>Swap Fee</th>
                    <th>Profit</th>
                    <th>Interest</th>
                    <th>Close Reason</th>
                    <th>Closed At</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="history-body"></tbody>
              </table>
            </div>
          </div>
        </section>

        <section class="view" id="view-settings">
          <div class="card">
            <h2 class="card-title">Settings</h2>
          </div>
        </section>
      </main>
    </div>
    <svg class="token-sprite" aria-hidden="true">
      <symbol id="token-eth" viewBox="0 0 512 512">
        <rect width="512" height="512" rx="15%" fill="#fff"></rect>
        <path fill="#3C3C3B" d="m256 362v107l131-185z"></path>
        <path fill="#343434" d="m256 41l131 218-131 78-132-78"></path>
        <path fill="#8C8C8C" d="m256 41v158l-132 60m0 25l132 78v107"></path>
        <path fill="#141414" d="m256 199v138l131-78"></path>
        <path fill="#393939" d="m124 259l132-60v138"></path>
      </symbol>
      <symbol id="token-usdc" viewBox="0 0 70 70">
        <path d="M69.9447 35.0675C69.9752 15.7746 54.3547 0.104605 35.0553 0.0674625C15.7559 0.0303197 0.0858281 15.6401 0.0552915 34.933C0.0247548 54.2258 15.6453 69.8958 34.9447 69.933C54.2441 69.9701 69.9142 54.3603 69.9447 35.0675Z" fill="#3574B9"></path>
        <path d="M29.339 56.8188C29.339 57.6071 28.8254 57.883 28.0551 57.883C23.39 56.3386 19.3181 53.2821 16.4309 49.1573C13.5438 45.0325 11.9916 40.0544 12 34.946C12.0085 29.8377 13.577 24.8651 16.4777 20.7508C19.3785 16.6364 23.4605 13.5945 28.1306 12.0669C28.8859 11.8068 29.4145 12.3349 29.407 13.139V15.0388C29.4127 15.3123 29.345 15.582 29.2115 15.8174C29.078 16.0528 28.8841 16.2446 28.6517 16.371C24.9783 17.7512 21.8012 20.2789 19.5528 23.6104C17.3044 26.942 16.0938 30.9155 16.0855 34.9906C16.0772 39.0658 17.2718 43.0446 19.5067 46.3861C21.7416 49.7275 24.9083 52.2692 28.5762 53.6655C28.8092 53.7912 29.0036 53.9828 29.1371 54.2184C29.2707 54.454 29.338 54.7241 29.3314 54.9978L29.339 56.8188Z" fill="white"></path>
        <path d="M37.0121 50.197C37.0034 50.4801 36.8943 50.7498 36.7059 50.9537C36.5175 51.1576 36.2633 51.2812 35.9925 51.3006H33.9459C33.6801 51.2819 33.4299 51.1628 33.2422 50.9654C33.0545 50.7681 32.9422 50.5061 32.9263 50.2285V47.0753C28.8329 46.5314 26.7938 44.135 26.031 40.6664C26.031 40.1383 26.2953 39.6022 26.7862 39.6022H29.0897C29.5957 39.6022 29.8449 39.8703 30.1093 40.3905C30.6153 42.2588 31.6197 43.8591 34.9579 43.8669C37.5106 43.8669 39.3005 42.5426 39.308 40.4142C39.3156 38.2858 38.2885 37.4817 34.7162 36.9378C29.3465 36.1495 26.7938 34.5256 26.8013 30.0007C26.8013 26.5401 29.3691 23.8756 32.949 23.3554V20.0918C32.9651 19.815 33.0777 19.554 33.2655 19.358C33.4533 19.1619 33.7034 19.0444 33.9685 19.0276H36.0152C36.2803 19.0444 36.5304 19.1619 36.7183 19.358C36.9061 19.554 37.0187 19.815 37.0348 20.0918V23.2923C40.101 23.8283 42.1402 25.6966 42.6462 28.6291C42.6462 29.1573 42.3894 29.6933 41.8909 29.6933H39.8593C39.3458 29.6933 39.1041 29.4253 38.8398 28.905C38.3338 27.0367 37.0574 26.2327 34.754 26.2327C32.2013 26.2327 30.9174 27.557 30.9174 29.3859C30.9174 31.2147 31.6726 32.3183 35.5092 32.8623C40.8714 33.6506 43.424 35.2745 43.4165 39.7993C43.4165 43.26 40.8563 46.1846 37.0197 46.9807L37.0121 50.197Z" fill="white"></path>
        <path d="M40.5767 56.866C40.5767 57.6622 41.0978 58.1983 41.8531 57.9302C46.5227 56.4004 50.6046 53.3587 53.5076 49.2458C56.4106 45.1329 57.984 40.1623 58 35.0537C58.0151 24.4038 51.1349 15.3304 41.9437 12.1142C41.1734 12.1142 40.6598 12.3901 40.6598 13.1784V15.0467C40.6541 15.3201 40.7218 15.5899 40.8553 15.8253C40.9887 16.0607 41.1826 16.2525 41.415 16.3789C45.0826 17.776 48.2488 20.3185 50.4831 23.6604C52.7173 27.0023 53.911 30.9814 53.902 35.0566C53.8929 39.1317 52.6814 43.105 50.4323 46.436C48.1832 49.767 45.0057 52.2941 41.332 53.6734C41.0996 53.7978 40.9055 53.988 40.7719 54.2222C40.6383 54.4565 40.5707 54.7252 40.5767 54.9978V56.866Z" fill="white"></path>
      </symbol>
      <symbol id="token-weth" viewBox="0 0 70 70">
        <path d="M50 60C50 62.7572 46.1707 65.8588 40.1176 67C37.6471 67 36.4431 67 32.5538 67C18.9931 67 8 63.866 8 60C8 56.134 18.9931 53 32.5538 53C46.1146 53 50 56.134 50 60Z" fill="black"></path>
        <path d="M68 32.1081C68 49.1842 52.8764 66 35.6964 66C18.5164 66 1 47.995 1 30.9189C1 13.8429 14.9271 0 32.1071 0C49.2871 0 68 15.0321 68 32.1081Z" fill="#F61F7D"></path>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M55.9616 53.275C61.4174 47.4418 64.8095 39.7244 64.8095 32.1081C64.8095 24.7567 60.7571 17.5462 54.4124 12.0689C48.0735 6.5967 39.8184 3.19355 32.1071 3.19355C16.668 3.19355 4.19048 15.6278 4.19048 30.9189C4.19048 38.4081 8.07407 46.4152 14.1793 52.6225C20.2845 58.8298 28.1857 62.8065 35.6964 62.8065C43.2327 62.8065 50.5086 59.1052 55.9616 53.275ZM35.6964 66C52.8764 66 68 49.1842 68 32.1081C68 15.0321 49.2871 0 32.1071 0C14.9271 0 1 13.8429 1 30.9189C1 47.995 18.5164 66 35.6964 66Z" fill="black"></path>
        <path d="M70 35.5C70 52.897 55.897 67 38.5 67C21.103 67 7 52.897 7 35.5C7 18.103 21.103 4 38.5 4C55.897 4 70 18.103 70 35.5Z" fill="white"></path>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M38.5 63.7966C54.1278 63.7966 66.7966 51.1278 66.7966 35.5C66.7966 19.8722 54.1278 7.20339 38.5 7.20339C22.8722 7.20339 10.2034 19.8722 10.2034 35.5C10.2034 51.1278 22.8722 63.7966 38.5 63.7966ZM38.5 67C55.897 67 70 52.897 70 35.5C70 18.103 55.897 4 38.5 4C21.103 4 7 18.103 7 35.5C7 52.897 21.103 67 38.5 67Z" fill="black"></path>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M8.81771 31L2 25.524L4.18229 23L11 28.476L8.81771 31Z" fill="black"></path>
        <path d="M17 29H19.8897L20.8023 37.7407L21.962 29.0185H24.2243L25.4411 37.6852L26.3726 29H29.2244L27.3802 44H24.4145L23.1027 34.9444L21.8669 44H18.8631L17 29Z" fill="black"></path>
        <path d="M31.834 29H38.7541V31.2593H35.237V34.9815H37.9176V37.2778H35.237V41.7593H38.7922V44H31.834V29Z" fill="black"></path>
        <path d="M42.6945 31.463H40.3371V29H48.455V31.463H46.1166V44H42.6945V31.463Z" fill="black"></path>
        <path d="M50.7985 29H54.2015V35.0741H56.5779V29H60V44H56.5779V37.4444H54.2015V44H50.7985V29Z" fill="black"></path>
      </symbol>
      <symbol id="chain-arbitrum" viewBox="0 0 238 238">
        <path d="M25.668 74.3076V163.693C25.668 169.4 28.7167 174.676 33.6545 177.52L111.032 222.222C115.969 225.066 122.048 225.066 126.986 222.222L204.363 177.52C209.301 174.676 212.35 169.4 212.35 163.693V74.3076C212.35 68.6005 209.301 63.3239 204.363 60.4797L126.986 15.7779C122.048 12.9337 115.969 12.9337 111.032 15.7779L33.6357 60.4797C28.698 63.3239 25.668 68.6005 25.668 74.3076Z" fill="#213147"></path>
        <path d="M135.889 136.336L124.853 166.611C124.554 167.453 124.554 168.37 124.853 169.212L143.838 221.305L165.796 208.619L139.442 136.336C138.844 134.671 136.487 134.671 135.889 136.336Z" fill="#12AAFF"></path>
        <path d="M158.015 85.4221C157.416 83.7568 155.059 83.7568 154.461 85.4221L143.426 115.697C143.126 116.539 143.126 117.456 143.426 118.298L174.53 203.585L196.488 190.899L158.015 85.4221Z" fill="#12AAFF"></path>
        <path d="M119 19.1272C119.542 19.1272 120.085 19.2769 120.571 19.5389L204.308 67.9082C205.28 68.4695 205.879 69.5174 205.879 70.6213V167.341C205.879 168.464 205.28 169.493 204.308 170.054L120.571 218.424C120.104 218.704 119.542 218.835 119 218.835C118.458 218.835 117.915 218.686 117.429 218.424L33.6924 170.092C32.7198 169.53 32.1213 168.483 32.1213 167.379V70.64C32.1213 69.5174 32.7198 68.4882 33.6924 67.9269L117.429 19.5576C117.915 19.2769 118.458 19.1272 119 19.1272ZM119 5C116.026 5 113.034 5.76717 110.359 7.32023L26.6411 55.6708C21.2919 58.7582 18 64.4652 18 70.64V167.36C18 173.535 21.2919 179.242 26.6411 182.329L110.378 230.698C113.052 232.233 116.026 233.019 119.019 233.019C121.993 233.019 124.985 232.252 127.66 230.698L211.396 182.329C216.746 179.242 220.037 173.535 220.037 167.36V70.64C220.037 64.4652 216.746 58.7582 211.396 55.6708L127.641 7.32023C124.966 5.76717 121.974 5 119 5Z" fill="#9DCCED"></path>
        <path d="M63.6191 203.698L71.3251 182.591L86.8304 195.483L72.3351 208.731L63.6191 203.698Z" fill="#213147"></path>
        <path d="M111.949 63.7168H90.72C89.1301 63.7168 87.7087 64.7085 87.1663 66.2054L41.6602 191.011L63.6183 203.698L113.726 66.2616C114.193 65.0266 113.277 63.7168 111.949 63.7168Z" fill="white"></path>
        <path d="M149.095 63.7168H127.866C126.276 63.7168 124.855 64.7085 124.312 66.2054L72.3535 208.712L94.3117 221.399L150.872 66.2616C151.321 65.0266 150.404 63.7168 149.095 63.7168Z" fill="white"></path>
      </symbol>
    </svg>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./app.js"></script>
  </body>
</html>
